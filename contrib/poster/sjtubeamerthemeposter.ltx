%% ------------------------------------------------------------------------
%% Copyright (C) 2022 LogCreative
%% 
%% Licensed under the Apache License, Version 2.0 (the "License");
%% you may not use this file except in compliance with the License.
%% You may obtain a copy of the License at
%% 
%%     http://www.apache.org/licenses/LICENSE-2.0
%% 
%% Unless required by applicable law or agreed to in writing, software
%% distributed under the License is distributed on an "AS IS" BASIS,
%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
%% See the License for the specific language governing permissions and
%% limitations under the License.
%% ------------------------------------------------------------------------
% 设置文件元数据
\ProvidesFile{sjtubeamerthemeposter.ltx}[2022/07/21 Beamerposter adapter for SJTUBeamer]
\PassOptionsToPackage{orientation=portrait}{beamerposter}
\if\EqualOption{poster}{landscape}{true}
  \PassOptionsToPackage{orientation=landscape}{beamerposter}
\fi
% 加载 beamerposter
\usepackage[size=a0,scale=1.4]{beamerposter}
% 设置 headline 颜色跟随亮色/暗色
\setbeamercolor{headline}{parent=palette primary}
\AtBeginDocument{
  % 修改 headline，需要在文档起始处覆盖，防止 default 的行为
  \setbeamertemplate{headline}{
    \begin{beamercolorbox}[wd=\paperwidth,sep=0.02\paperwidth]{headline}
      \begin{columns}
        \begin{column}{0.25\textwidth}
          \hspace*{0.02\paperwidth}
          \if\EqualOption{poster}{sepinst}{true}%
            \resizebox{!}{4cm}{\vphantom{-}\usebeamertemplate{logo}}
          \else%
            \if\EqualOption{inner}{lang}{en}%
              \resizebox{!}{4cm}{\vphantom{-}\secondaryinstlogo{\csname beamer@shortinstitute\endcsname}{\usebeamertemplate{logo}}}
            \else%
              \resizebox{!}{4cm}{\vphantom{-}\secondaryinstlogo[\insertshortinstitute]{\insertinstitute}{\usebeamertemplate{logo}}}
            \fi%
          \fi%
        \end{column}
        \begin{column}{0.5\textwidth}
          \vfill
          \centering
          \usebeamercolor{title in headline}{%
            \color{fg}\textbf{\LARGE{\inserttitle}}\vskip2.5ex
          }
          \usebeamercolor{author in headline}{%
            \color{fg}\large{\insertauthor}
          }
          \vfill
        \end{column}
        \begin{column}{0.25\textwidth}
          \if\EqualOption{poster}{sepinst}{true}
            \hfill
            \if\EqualOption{inner}{lang}{en}
              \resizebox{!}{4cm}{\vphantom{-}\secondaryinstlogo{\csname beamer@shortinstitute\endcsname}{}}
            \else
              \resizebox{!}{4cm}{\vphantom{-}\secondaryinstlogo[\insertshortinstitute]{\insertinstitute}{}}
            \fi
            \hspace*{0.03\paperwidth}
          \else
            \begin{tikzpicture}[overlay]
              \if\EqualOption{poster}{landscape}{true}
                \def\stampheight{0.05}
                \def\stampsize{60pt}
              \else
                \def\stampheight{0.03}
                \def\stampsize{50pt}
              \fi
              \usebeamercolor{palette primary}
              \stamparray{\stampsize}{(-0.05\paperwidth,-\stampheight\paperheight)}{(\paperwidth,\stampheight\paperheight)}
              \fill[bg, path fading=fade right] (-0.05\paperwidth, -\stampheight\paperheight) rectangle (\paperwidth, \stampheight\paperheight);
            \end{tikzpicture}
          \fi
        \end{column}
      \end{columns}
    \end{beamercolorbox}
  }
}
% 设置底栏
\setbeamercolor{footline}{parent=palette primary}
\setbeamertemplate{footline}{%
  \resizebox{\paperwidth}{!}{\sjtugate[cprimary]}\vskip-6cm\par
    \begin{beamercolorbox}[wd=\paperwidth]{footline}
      \small\vskip1.5ex\hspace*{0.02\paperwidth}\insertsection\hfill
      \insertsubsection\hspace*{0.02\paperwidth}\vskip2.1ex
    \end{beamercolorbox}
}