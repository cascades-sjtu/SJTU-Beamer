\documentclass{ltxdoc}
\usepackage[scheme=plain]{ctex}
\usepackage[colorlinks]{hyperref}
\usepackage{fontspec}
\defaultfontfeatures{Extension=.otf}
\usepackage{fontawesome}
\usepackage{tcolorbox}
\tcbuselibrary{skins}

\tcbset{
    enhanced,
    notitle,
    sharp corners,
    colframe=yellow,
    boxrule=1pt,
    center
}

\newtcolorbox{warn}[1][]{
    colback=yellow!5,
    borderline west={2mm}{0mm}{yellow},
    before upper={\textcolor{yellow}{\large\faWarning\ }},
    #1
}

\usepackage{listings}
\lstset{
    basicstyle=\ttfamily, 
    frame=single, 
    columns=flexible, 
    extendedchars=false
}

\def\fcmd#1{\paragraph{\fbox{\ttfamily #1}}}

\def\themename{\textsf{SJTUBeamer}}
\title{Development Guide of\\\themename}

\begin{document}
    \maketitle
    \tableofcontents
    \clearpage

    \section{Build}

    \subsection{l3build}

    \themename{} adopts \verb"l3build" system to build the package. After entering the source code directory:
    \begin{verbatim}
        cd src
    \end{verbatim}
    You could operate the package by the following command. The build script is set in \verb"build.lua".

    \fcmd{l3build doc} This command will generate the documentation of this package. We set an overall testing file \verb"doc/min.tex" to test all features of \themename. This is the most common command for testing a certain feature.
    \begin{center}
        unpack $\rightarrow$ \verb"min.tex" $\rightarrow$ documentations
    \end{center}

    \fcmd{l3build check} Process a regression test, with an optional parameter to perform one of the following tests:
    \begin{center}
        \ttfamily color font inner outer sjtuvi
    \end{center}
    which will show if the module is standing-free. If the compilation error occurs, please check if your code uses one definition from another module without requiring it first, or undefined control sequence occurs.

    \fcmd{l3build save color} If you make some modification to the framework (except \verb"sjtucover") and change the result. To save the current result as a reference, run this command and \verb"color" could be exchanged by any of the test units above.

    \fcmd{l3build clean} Clean the current \verb"src/build" directory, which will be useful if you modified one of the temporary files in that directory. (In this case, you may perform a wrong test with a modified version since \verb"l3build doc" may not refresh it.)

    \fcmd{l3build tag v1.5.0} Tag the version of the source code, which will also update the date in the source code.

    \fcmd{l3build ctan} This is the last step before release. Both \verb"l3build check" and \verb"l3build doc" will be performed. The generated file is \verb"src/sjtubeamer-ctan.zip".

    More information about \verb"l3build", please refer to
    \begin{verbatim}
        texdoc l3build
    \end{verbatim}

    \subsection{Customize Generation}

    In \verb"source/beamerthemesjtubeamer.ins", you could customize what templates you want to output on the line:
    \begin{verbatim}
        \def\preserveoption{,maxplus,max,min,my} 
    \end{verbatim}
    Reduce the parameter number will reduce the number of templates it generates. It is useful if you want to debug or make a slight performance jump. Or make your own version of this template.

    \begin{warn}
    \textbf{When you are pulling a request, the item in this column cannot be changed}. The extraction on your template should be decided by end users since large generation files could cause a performance drop on compiling. We are also glad to add your template to this column if your template is picked.
    \end{warn}

    \subsection{Pull Request}

    Before making a pull request, please refresh the root \verb".sty" files first in order to pass CI. In fact, if you are using \verb"l3build", we have embeded this action in \verb"l3build check" (which is included in \verb"l3build ctan"). But we still recommend that you should make a final run on the script. Switch to the main directory:
    \begin{verbatim}
        cd ..
    \end{verbatim}
    Then, run the bash code on *nix.
    \begin{verbatim}
        .github/ci/build_package.sh
    \end{verbatim}

    And all other scripts in the folder could also be checked in your local machine to make sure you can pass the CI on GitHub Actions.

    If you are a Windows user\footnote{Windows 10 users could also install WSL (Windows Subsystem for Linux) in order to use Linux environment conveniently. This also provides a faster speed on compiling.} and your \verb"l3build" distribution is not 2021/08/28 and later, please use the old extracting method in \verb"src/source":
    \begin{verbatim}
        latex beamerthemesjtubeamer.ins
    \end{verbatim}
    and copy the corresponding generated files to the root directory.

    \subsection{Check Integration}

    TBD.

    \section{Coding Style}

    This section gives a contribution code on coding style. Every contributor should follow this coding style if you want to make a pull request to this project.

    \subsection{Framework Code}

    The coding style in this section is available for the following files:
    \begin{verbatim}
        beamerthemesjtubeamer.dtx
        beamercolorthemesjtubeamer.dtx
        beamerfontthemesjtubeamer.dtx
        beamerinnerthemesjtubeamer.dtx
        beamerouterthemesjtubeamer.dtx
        sjtuvi.dtx
    \end{verbatim}

    \subsubsection{Support Version}

    We only support \TeX{} or \LaTeX{} code on these files. No \LaTeX3 code supported since \verb"beamer" is not written in \LaTeX3 and this template has a major dependency on \verb"beamer" class.

    \subsubsection{Kernel Function Definition}

    Kernel function means that it is not recommended to be used by end users.

    \paragraph{If your definition parameters are mandatory, use \TeX\ style.} This gives you better flexibility on the definition. And in this scenario, please use a \emph{unique} command name for your function.

    \begin{lstlisting}
\def\EqualOption#1#2#3{}
    \end{lstlisting}

    \subparagraph{Pros:} Using the bottom layer on \TeX{} gives better processing speed. And make the parameter declared obviously will make the code more readable, so as the end user.

    \subparagraph{Cons:} Using \TeX{} \verb"\def" method will skip the defined macro check provided by \LaTeX{}, which may cause macro conflict between different packages.

    \subparagraph{Decision:} Use complicated name if you want to avoid naming conficts on function. This template won't provide a mandatory rule on this.

    \paragraph{If your definition has an optional parameter, use \LaTeX\ style.} The maximum number of optional parameter is 1 only. You cannot have more optional parameters. Give the default optional parameter in the second square brackets.

    \begin{lstlisting}
\expandafter\providecommand\csname #1\endcsname
    [1][\sjtubeamer@logocolor]{}
    \end{lstlisting}

    \subparagraph{Pros:} Using this method could get an optional parameter.

    \subparagraph{Cons:} This method is less readable. And have to decide to use \verb"\newcommand" (check on duplicate functions) or \verb"\providecommand" (skip uniquness check).

    \subparagraph{Decision:} Just use this method if you want an optional parameter. You should not write a function with more than one optional parameters.

    \subsubsection{Interface Function Definition}

    Interface function means that the function will be used by end users.

    \paragraph{Use \LaTeX\ style on function definition.} This gives a clear visual indication on the type of this function.

    \begin{lstlisting}
\newcommand{\stamparray}[3]{}
    \end{lstlisting}

    \subparagraph{Pros:} This method will avoid the conflict on packages. Or it is easy to debug to know which package conflicts.

    \subparagraph{Cons:} This method will limit some features \TeX{} provides and you may not pass the compilation if you switch some \verb"\def" to \verb"\newcommand" or \verb"\providecommand".

    \subparagraph{Decision:} Use unique name on interface function.

    \section{Implementation}
% The DocTeX follows the alphabatic order to input.
    \DocInput{beamercolorthemesjtubeamer.dtx}
    \DocInput{beamerfontthemesjtubeamer.dtx}
    \DocInput{beamerinnerthemesjtubeamer.dtx}
    \DocInput{beamerouterthemesjtubeamer.dtx}
    \DocInput{beamerthemesjtubeamer.dtx}
% SJTUG doesn't hold the copyright of the following code.
    \DocInput{sjtucover.dtx}
    \DocInput{sjtuvi.dtx}
\end{document}